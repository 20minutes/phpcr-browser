<div ng-controller="mbWorkspaceCtrl">
  <div id="sidebar">
      <mb-scrollable class="scrollable-tree">
        <mb-tree mb-current-node="currentNode"></mb-tree>
      </mb-scrollable>
    </div>
  <div id="content" ng-controller="mbPropertiesCtrl">
      <div id ="properties-header">
        <ol class="breadcrumb col-sm-10">
          <li>
            <a href="#/{{ currentNode.getWorkspace().getRepository().getName() }}/{{ currentNode.getWorkspace().getName() }}">
              root
            </a>
          </li>
          <li
            ng-repeat="(key, n) in breadcrumb"
            ng-if="n.length > 0">
            <a href="#/{{ currentNode.getWorkspace().getRepository().getName() }}/{{ currentNode.getWorkspace().getName() }}{{ currentNode.getPath().split('/').slice(0, key + 1).join('/') }}">
              {{ n }}
            </a>
          </li>
        </ol>
        <a class="pull-right btn btn-primary btn-sm add-property" ng-class="{ active: displayCreateForm }" ng-click="toggleCreateForm()">
          <span class="glyphicon glyphicon-plus" ng-show="!displayCreateForm"></span>
          <span class="glyphicon glyphicon-minus" ng-show="displayCreateForm"></span>
          Add property
        </a>
      </div>
      <mb-scrollable class="scrollable-properties">
        <table id="properties">
          <tbody>
            <tr ng-show="displayCreateForm" class="info">
              <td></td>
              <td>
                <input type="text" ng-model="name" mb-focus-me="displayCreateForm" class="form-control" placeholder="Enter a name" ui-keypress="{ enter: 'createProperty(name, value, type.value)' }" ui-keydown="{ esc: 'toggleCreateForm()' }">
              </td>
              <td>
                <input type="text" ng-model="value" class="form-control" placeholder="Then enter a value and press Enter" ui-keypress="{ enter: 'createProperty(name, value, type.value)' }" ui-keydown="{ esc: 'toggleCreateForm()' }">
              </td>
              <td>
                <select ng-model="type" class="form-control" ng-options="type.name for type in types">
                  <option value="">Type</option>
                </select>
              </td>
            </tr>
            <tr ng-show="backup !== null" class="warning">
              <td></td>
              <td>
                Do you want to restore {{ backup.name }} ?
              </td>
              <td></td>
              <td><a ng-click="restoreProperty()" id="restore">Yes</a> <a ng-click="backup=null">No</a></td>
            </tr>
            </tr>
            <tr class="property-item" data-ng-repeat="property in properties | orderBy:'property.name' | mbJaroWinkler:search" id="{{ property.name }}" draggable="{{ currentNode.getWorkspace().getRepository().supports('node.property.delete') }}" data-name="{{ property.name }}">
              <td><span class="fa fa-bars" title="Drag me to delete me"></span></td>
              <td>
                <span class="text-primary">{{ property.name }}</span>
                <br/>
                <small><span title="Property type" editable-select="property.type" buttons="no" e-style="margin-top: 5px;" e-ng-options="type.name for type in types" onbeforesave="updatePropertyType(property.name, $data.value)">{{ typeLabel(property.type) }}</span></small>
              </td>
              <td colspan="2" mb-property-value></td>
            </tr>
          </tbody>
        </table>
    </mb-scrollable>
    <mb-dropper drop="delete"></mb-dropper>
</div>
